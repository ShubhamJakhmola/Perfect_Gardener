<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Post â€” Perfect Gardener</title>
    <link rel="icon" href="Avtar.png" type="image/png" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
    <style>
      html { scroll-behavior: smooth; }

      .post-wrapper {
        max-width: 800px;
        margin: 40px auto;
        padding: 0 20px;
      }

      .post-header {
        text-align: center;
        margin-bottom: 20px;
      }

      .post-header h1 {
        margin: 0 0 10px;
      }

      .post-cover {
        width: 100%;
        border-radius: 12px;
        border: 1px solid var(--ring, #ccc);
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      }

      .prose {
        line-height: 1.7;
        font-size: 1rem;
      }

      .prose img {
        max-width: 100%;
        border-radius: 8px;
        margin: 10px 0;
      }

      .muted {
        color: gray;
        text-align: center;
        margin-top: 50px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>

  <body>
    <!-- ðŸ”¹ Header -->
    <header class="site-header" id="top">
      <div class="container header-inner">
        <div class="brand">
          <img src="Avtar.png" alt="Perfect Gardener logo" class="logo" width="28" height="28" />
          <a class="brand-name" href="index.html" style="text-decoration:none; color: inherit;">Perfect Gardener</a>
        </div>
        <nav class="main-nav">
          <a href="products.html">Products</a>
          <a href="posts/index.html">Posts</a>
          <a href="#youtube">YouTube</a>
          <a href="#contact">Contact</a>
        </nav>
      </div>
    </header>

    <!-- ðŸ”¹ Main post area -->
    <main>
      <div class="post-wrapper">
        <div id="loading" class="muted">Loading...</div>

        <div id="postContainer" hidden>
          <div class="post-header">
            <h1 id="postTitle">Loadingâ€¦</h1>
            <img id="postCover" class="post-cover" alt="Post cover" />
          </div>
          <div id="postBody" class="prose"></div>
        </div>
      </div>
    </main>

    <!-- ðŸ”¹ Footer -->
    <footer class="site-footer">
      <div class="container footer-inner">
        <p>Â© <span id="year"></span> Perfect Gardener</p>
        <a class="to-top" href="#top">Back to top â†‘</a>
      </div>
    </footer>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear();

      document.addEventListener("DOMContentLoaded", async () => {
        const params = new URLSearchParams(window.location.search);
        const slug = params.get("slug");

        const loadingEl = document.getElementById("loading");
        const postContainer = document.getElementById("postContainer");
        const postTitle = document.getElementById("postTitle");
        const postCover = document.getElementById("postCover");
        const postBody = document.getElementById("postBody");

        if (!slug) {
          loadingEl.textContent = "No post specified.";
          return;
        }

        try {
          const res = await fetch("posts/index.json");
          if (!res.ok) throw new Error("Failed to fetch posts index");

          const data = await res.json();
          const post = data.posts.find(p => p.slug === slug);
          if (!post) throw new Error("Post not found in index.json");

          const mdRes = await fetch(`posts/${slug}.md`);
          if (!mdRes.ok) throw new Error("Markdown file not found");
          const markdown = await mdRes.text();

          loadingEl.hidden = true;
          postContainer.hidden = false;

          postTitle.textContent = post.title;
          postCover.src = post.cover;
          postBody.innerHTML = marked.parse(markdown);

        } catch (err) {
          console.error("Error loading post:", err);
          loadingEl.textContent = "Failed to load post.";
        }
      });
    </script>
  </body>
</html>
